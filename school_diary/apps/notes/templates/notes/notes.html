{% extends 'base/base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/../../static/css/notes.css' %}">
    <link rel="stylesheet" href="{% static 'js/viewerjs/viewer.min.css' %}">
    <script src="{% static 'js/viewerjs/viewer.min.js' %}"></script>
{% endblock %}

{% block content %}

    <div class="container my-5">

        <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link active" id="home-tab" data-bs-toggle="tab" href="#all-notes" role="tab">Все</a>
            </li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" id="profile-tab" data-bs-toggle="tab" href="#my-notes" role="tab">Мои конспекты</a>
            </li>
        </ul>

        <div class="tab-content">

            <div class="tab-pane fade show active" id="all-notes" role="tabpanel">
                <div id="feed" class="mt-4">
                    <div v-if="notes && notes.length > 0">
                        <template v-for="note in notes">
                            <div class="row notes-group-row mb-3">
                                <div class="col-auto">
                                    <img :src="note.thumbnail" class="card-img-top" alt="">
                                </div>
                                <div class="col-auto">
                                    <h2>[[ note.title ]]</h2>
                                    <div class="text-muted">
                                        Автор: [[ note.author.surname ]] [[ note.author.first_name ]] - [[
                                        note.author.klass ]]
                                        <br>
                                        [[ getDate(note.upload_date) ]]
                                        <br>
                                        [[ getFileSize(note.files_size) ]]
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div v-else>
                        <div class="text-center">
                            Не было добавлено ещё ни одного конспекта
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-pane fade" id="my-notes" role="tabpanel">

                <div id="create-and-view-list">
                    <button class="btn btn-outline-primary mt-4" data-bs-toggle="modal"
                            data-bs-target="#addNoteGroupModal"><i
                            class="fas fa-plus me-2"></i>Добавить
                    </button>

                    <div class="modal fade" id="addNoteGroupModal" data-bs-backdrop="static" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Добавление конспекта</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div id="my-notes-create">
                                        <form method="post">
                                            {% csrf_token %}
                                            <div class="mb-3">
                                                {% with field=form.title %}
                                                    {% include "field.html" %}
                                                {% endwith %}
                                            </div>
                                            <div class="mb-3">
                                                {% with field=form.category %}
                                                    {% include "field.html" %}
                                                {% endwith %}
                                            </div>
                                            <div class="mb-3">
                                                {% with field=form.public %}
                                                    {% include "field.html" %}
                                                {% endwith %}
                                            </div>
                                            <div class="text-center">
                                                <button class="btn btn-outline-primary" name="addNoteGroup">Сохранить
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="my-notes-list" class="mt-4">
                        <div v-if="notes">
                            <table class="table">
                                <thead>
                                <tr class="table-dark">
                                    <th>Название</th>
                                    <th>Дата</th>
                                    <th>Размер</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="note in notes" v-on:click="initGroupEdit(note.id)">
                                    <td>[[ note.title ]]</td>
                                    <td>[[ note.upload_date ]]</td>
                                    <td>[[ getFileSize(note.files_size) ]]</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div v-else class="text-center">
                            Вы ещё не добавляли конспекты
                        </div>
                    </div>
                </div>

                <div id="notes-group-edit" class="mt-4">
                    <div v-if="notes !== undefined">
                        <a @click="goToMainPage()" onclick="" href="#">Вернуться назад</a>

                        <div class="mt-3 mb-3">
                            <label for="notesGroupTitle" class="form-label">Название</label>
                            <input id="notesGroupTitle" :value="notesGroup.title" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label for="notesGroupDescription" class="form-label">Описание</label>
                            <textarea id="notesGroupDescription" class="form-control" :value="notesGroup.description">
                            </textarea>
                        </div>
                        <div class="form-check">
                            <input id="notesGroupPublic" type="checkbox" class="form-check-input">
                            <label for="notesGroupPublic" class="form-check-label" :checked="notesGroup.public">Виден
                                ученикам из других классов</label>
                        </div>

                        <div class="my-5">
                            <div v-if="notes.length > 0">
                                <div class="mb-3">
                                    [[ notes.length ]] стр., [[ getFileSize(notesGroup.files_size) ]]
                                </div>
                                <div class="row" ref="photos">
                                    <div v-for="note in notes" class="col-md-2 col-4 mb-4">
                                        <div draggable="true">
                                            <img :src="[[ note.image ]]" alt="" width="100%" @click="showImage"
                                                 @contextmenu="showImageMenu">
                                            <div class="delete-note" @click="deleteNote(note.id, $event)"><i
                                                    class="fas fa-trash"></i></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div v-else>
                                <div class="alert alert-primary text-center">
                                    Эта группа конспектов пуста
                                    <br>
                                    Добавьте новые фотографии, используя форму ниже
                                </div>
                            </div>
                        </div>

                        <div v-if="error415alert" v-on:click="error415alert = false"
                             class="alert alert-danger mt-3 text-center">
                            Отправленный формат фото не поддерживается. Попробуйте отправить JPG/JPEG/PNG.
                        </div>


                        <form id="dragFileForm" class="mt-4" method="post" ref="dragFileForm"
                              enctype="multipart/form-data" multiple novalidate>
                            {% csrf_token %}
                            <div class="px-5 py-5 mb-3" id="dragFileBox">
                                <div class="text-center">
                                    <input type="file" name="files" id="file" class="box__file"
                                           data-multiple-caption="{count} files selected" multiple>
                                    <label for="file"><strong>Выберите файл</strong><span class="box__dragndrop"> или перетащите его</span></label>
                                </div>
                            </div>
                            <div class="form-check">
                                <input id="filterPhotoInput" name="filterPhoto" class="form-check-input" type="checkbox"
                                       checked>
                                <label for="filterPhotoInput" class="form-check-label">Применить фильтр к фото</label>
                                <div class="form-text">Эта функция увеличит контрастность и яркость загружаемых фото
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{% static 'js/../../static/js/notes.js' %}"></script>
{% endblock %}
