{% extends 'base.html' %}
{% load static %}

{% block title %}
<title>Оценки</title>
{% endblock %}

{% block css %}
<style>
    .sm-width {
        width:2%;
    }
    .md-width {
        width:10%;
    }
</style>
{% endblock %}

{% block content %}
    <div class="container my-5">
        <div class="table-responsive">
            <table class="table table-sm table-bordered">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Предмет</th>
                    <th scope="col" class="text-center" tabindex="0" data-trigger="focus" data-toggle="popover" title="Средний балл" data-content="Высчитывается исходя из среднего арифметического оценок.">AVG</th>
                    <th scope="col" class="text-center" tabindex="0" data-trigger="focus" data-toggle="popover" title="Взвешенный средний балл" data-content="Взвешенный балл высчитывается с помощью системы весов - исходя из значимости определенного вида работы.">SM.AVG</th>
                    <th scope="col" colspan="{{ max_length }}"></th>
                  </tr>
                </thead>
                <tbody>
                    {% for subject, marks in d.items %}
                        <tr>
                            <th scope="row" class="sm-width">{{ forloop.counter }}</th>
                            <td class="md-width"><a href="{{ subject.id }}/{{term}}/">{{ subject }}</a></td>
                            <td class="text-center md-width">{{ marks.0 }}</td>
                            <td class="text-center md-width">{{ marks.1 }}</td>
                            {% for mark in marks.2 %}
                                {% if mark.amount == 2 %}
                                <td scope="col" style="color:red" tabindex="0" data-trigger="focus" data-toggle="popover" title="{{ mark.lesson.date|date:'d.m, D' }}" data-content="<b>{{ mark.lesson.control }}</b><br>{{ mark.comment }}"><b>{{ mark.amount }}</b></td>
                                {% elif mark.amount == 3 %}
                                    <td scope="col" style="color:orangered" tabindex="0" data-trigger="focus" data-toggle="popover" title="{{ mark.lesson.date|date:'d.m, D' }}" data-content="<b>{{ mark.lesson.control }}</b><br>{{ mark.comment }}"><b>{{ mark.amount }}</b></td>
                                {% elif mark.amount == 4 %}
                                    <td scope="col" style="color:darkorange" tabindex="0" data-trigger="focus" data-toggle="popover" title="{{ mark.lesson.date|date:'d.m, D' }}" data-content="<b>{{ mark.lesson.control }}</b><br>{{ mark.comment }}"><b>{{ mark.amount }}</b></td>
                                {% elif mark.amount == 5 %}
                                    <td scope="col" class="text-success" tabindex="0" data-trigger="focus" data-toggle="popover" title="{{ mark.lesson.date|date:'d.m, D' }}" data-content="<b>{{ mark.lesson.control }}</b><br>{{ mark.comment }}"><b>{{ mark.amount }}</b></tdcolspan="100">
                                {% else %}
                                    <td scope="col" class="text-secondary" tabindex="0" data-trigger="focus" data-toggle="popover" title="{{ mark.lesson.date|date:'d.m, D' }}" data-content="<b>{{ mark.lesson.control }}</b><br>{{ mark.comment }}"><b>Н</b></td>
                                {% endif %}
                            {% endfor %}
                            
                            {% for n in marks.3 %}
                            <td></td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                </tbody>
              </table>
              <p>Всего пропущено уроков: {{ total_missed  }}</p>
        </div>
        <input id="copy_btn" type="button" class="btn btn-primary" value="Скопировать">
    </div>
    <script>
        $('[data-toggle="popover"]').popover({ trigger: "focus", html:true });
        var copyBtn = document.querySelector('#copy_btn');
        copyBtn.addEventListener('click', function () {
            var urlField = document.querySelector('table');
            range.selectNode(urlField);
            document.execCommand('copy');
        }, false);
    </script>
{% endblock %}